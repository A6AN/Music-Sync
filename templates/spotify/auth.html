{% extends "base.html" %}

{% block title %}Connect Spotify{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="bi bi-spotify"></i> Connect Spotify
                </h4>
            </div>
            <div class="card-body p-5">
                <p class="lead">To sync your Spotify playlists, we need to connect to your account.</p>
                
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> This will open Spotify's authorization page in a new window.
                    Grant access and you'll be redirected back here.
                </div>
                
                <button class="btn btn-spotify btn-lg" onclick="connectSpotify()">
                    <i class="bi bi-spotify"></i> Connect with Spotify
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function connectSpotify() {
    // TODO: Get this from environment variable or settings
    // For now, this is the client ID from settings.json
    const clientId = '{{ config.SPOTIFY_CLIENT_ID or "329e873b7a9f45a4a8128770e084e27c" }}';
    const redirectUri = window.location.origin + '/spotify/callback';
    const scope = 'playlist-read-private playlist-read-collaborative user-library-read playlist-modify-public playlist-modify-private';
    
    // Use Authorization Code flow instead of Implicit Grant
    const authUrl = `https://accounts.spotify.com/authorize?` +
        `response_type=code&` +
        `client_id=${clientId}&` +
        `scope=${encodeURIComponent(scope)}&` +
        `redirect_uri=${encodeURIComponent(redirectUri)}`;
    
    console.log('Redirect URI:', redirectUri);
    console.log('Auth URL:', authUrl);
    
    window.location.href = authUrl;
}
</script>
{% endblock %}
